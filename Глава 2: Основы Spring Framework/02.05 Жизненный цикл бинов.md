## Жизненный цикл бинов в Spring

Жизненный цикл бинов в Spring Framework охватывает все этапы, через которые проходит бин от его создания до уничтожения. Понимание этого процесса критически важно для эффективного управления ресурсами и зависимостями в приложении. В этой главе мы рассмотрим основные этапы жизненного цикла бинов, методы и аннотации, которые можно использовать для настройки поведения бинов на каждом из этапов.

### Основные этапы жизненного цикла бина

1. **Создание бина**: Когда контейнер Spring инициализируется, он создает экземпляры всех бинов, определенных в конфигурации. Это может быть сделано с помощью конструктора или фабричного метода.

2. **Внедрение зависимостей**: После создания бина контейнер внедряет все необходимые зависимости. Это может быть выполнено через конструкторы, сеттеры или аннотации.

3. **Настройка бина**: На этом этапе контейнер вызывает методы инициализации, которые могут быть определены в коде бина или с помощью аннотаций, таких как `@PostConstruct`. Эти методы могут использоваться для выполнения дополнительных действий после того, как все свойства были установлены.

4. **Использование бина**: После настройки бин готов к использованию в приложении. Клиентский код может получить доступ к бину через контейнер и вызывать его методы.

5. **Уничтожение бина**: Когда контейнер закрывается или бин больше не нужен, он вызывает методы уничтожения, которые могут быть определены в коде бина или с помощью аннотаций, таких как `@PreDestroy`. Эти методы могут использоваться для освобождения ресурсов или выполнения завершающих действий.

### Методы управления жизненным циклом

Spring предоставляет несколько способов управления жизненным циклом бинов:

#### 1. Интерфейсы `InitializingBean` и `DisposableBean`

Разработчики могут реализовать интерфейсы `InitializingBean` и `DisposableBean`, чтобы определить методы инициализации и уничтожения:

- `afterPropertiesSet()`: вызывается после установки всех свойств.
- `destroy()`: вызывается перед уничтожением бина.

Пример:

```java
import org.springframework.beans.factory.InitializingBean;
import org.springframework.beans.factory.DisposableBean;

public class MyBean implements InitializingBean, DisposableBean {
    @Override
    public void afterPropertiesSet() {
        // Логика инициализации
    }

    @Override
    public void destroy() {
        // Логика уничтожения
    }
}
```

#### 2. Аннотации `@PostConstruct` и `@PreDestroy`

Эти аннотации предоставляют более современный способ управления жизненным циклом:

- `@PostConstruct`: метод помеченный этой аннотацией будет вызван после установки всех свойств.
- `@PreDestroy`: метод помеченный этой аннотацией будет вызван перед уничтожением бина.

Пример:

```java
import jakarta.annotation.PostConstruct;
import jakarta.annotation.PreDestroy;

@Component
public class MyBean {
    @PostConstruct
    public void init() {
        // Логика инициализации
    }

    @PreDestroy
    public void cleanup() {
        // Логика очистки ресурсов
    }
}
```

### Конфигурация методов инициализации и уничтожения

Кроме использования интерфейсов и аннотаций, можно также указать методы инициализации и уничтожения в XML-конфигурации:

```xml
<bean id="myBean" class="com.example.MyBean" init-method="init" destroy-method="cleanup"/>
```

### Области видимости бинов

Область видимости определяет количество экземпляров бина, создаваемых на протяжении его жизненного цикла. В Spring существуют следующие области видимости:

- **Singleton**: один экземпляр на весь контекст приложения (по умолчанию).
- **Prototype**: новый экземпляр создается при каждом запросе.
- **Request**: новый экземпляр создается для каждого HTTP-запроса (только для веб-приложений).
- **Session**: новый экземпляр создается для каждой HTTP-сессии (только для веб-приложений).
- **Global session**: используется в портлетах.
- **Application**: один экземпляр на все приложение (аналогично Singleton).

### Заключение

Жизненный цикл бинов в Spring — это важный аспект, который необходимо учитывать при разработке приложений. Понимание каждого этапа помогает эффективно управлять ресурсами и зависимостями, что приводит к более стабильным и производительным приложениям. Используя различные механизмы управления жизненным циклом, такие как интерфейсы, аннотации и XML-конфигурации, разработчики могут настроить поведение своих бинов в соответствии с требованиями приложения.

Citations:
[1] https://dzen.ru/a/ZTofRkInOmGQaOQ1
[2] https://ru.hexlet.io/courses/java-spring-boot/lessons/beans/theory_unit
[3] https://www.youtube.com/watch?v=MR_h8kljt-w
[4] https://javarush.com/quests/lectures/questspring.level01.lecture21
[5] https://proselyte.net/tutorials/spring-tutorial-full-version/bean-lifecycle/
[6] https://habr.com/ru/articles/720794/
[7] https://itsobes.com/ru/java/opishite-zhiznennyi-tsikl-spring-bean/
[8] https://dzen.ru/a/ZZV_9icKAQiqTx4j

---
Answer from Perplexity: https://www.perplexity.ai/search/glava-iz-300-strok-chto-takoe-9WcTmuznQ.6R5kqMKVn1ng?utm_source=copy_output
